<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçï –ü–∏—Ü—Ü–∞-–¥–µ—Ç–µ–∫—Ç–∏–≤ –°—ã–∫—Ç—ã–≤–∫–∞—Ä | –ê–≤—Ç–æ—Ü–µ–Ω—ã</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Arial', sans-serif; }
        body { background: #fff5f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; padding: 40px 0; }
        h1 { color: #e74c3c; font-size: 2.5rem; margin-bottom: 10px; }
        .subtitle { color: #666; margin-bottom: 20px; }
        .stats-bar { background: white; padding: 15px; border-radius: 10px; margin: 20px 0; display: flex; justify-content: space-around; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .stat-item { text-align: center; }
        .stat-number { font-size: 1.5rem; font-weight: bold; color: #e74c3c; }
        .stat-label { font-size: 0.9rem; color: #666; }
        #pizzaList { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; margin: 30px 0; }
        .pizza-card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: transform 0.3s; }
        .pizza-card:hover { transform: translateY(-5px); }
        .pizza-name { font-size: 1.3rem; color: #2c3e50; margin-bottom: 10px; }
        .pizza-price { font-size: 2rem; color: #27ae60; font-weight: bold; margin: 10px 0; }
        .pizza-rating { color: #f39c12; margin: 5px 0; }
        .pizza-address { color: #7f8c8d; margin: 5px 0; font-size: 0.9rem; }
        .promo-badge { background: #ff6b6b; color: white; padding: 3px 10px; border-radius: 20px; font-size: 0.8rem; display: inline-block; margin: 5px 0; }
        .buttons { display: flex; gap: 10px; margin-top: 15px; }
        .btn { padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: bold; display: inline-flex; align-items: center; gap: 5px; }
        .btn-yandex { background: #ffcc00; color: #000; }
        .btn-order { background: #e74c3c; color: white; }
        .update-info { text-align: center; color: #95a5a6; margin: 20px 0; }
        .loader { border: 5px solid #f3f3f3; border-top: 5px solid #e74c3c; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @media (max-width: 768px) { #pizzaList { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-pizza-slice"></i> –ü–∏—Ü—Ü–∞-–¥–µ—Ç–µ–∫—Ç–∏–≤ –°—ã–∫—Ç—ã–≤–∫–∞—Ä</h1>
            <p class="subtitle">–°–∞–º—ã–µ —Å–≤–µ–∂–∏–µ —Ü–µ–Ω—ã –Ω–∞ –ø–∏—Ü—Ü—É. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.</p>
        </header>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-number" id="totalPlaces">0</div>
                <div class="stat-label">–ø–∏—Ü—Ü–µ—Ä–∏–π –≤ –±–∞–∑–µ</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="avgPrice">0</div>
                <div class="stat-label">—Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="lastUpdate">...</div>
                <div class="stat-label">–æ–±–Ω–æ–≤–ª–µ–Ω–æ</div>
            </div>
        </div>

        <div id="loading" class="loader"></div>

        <div id="pizzaList"></div>

        <div class="update-info">
            <p>üìÖ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ 8:00 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å</p>
            <p>üîç –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤</p>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è - –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–ò –î–ê–ù–ù–´–ï –ù–ê –°–í–û–ò!
        const SUPABASE_URL = 'https://niublpflhtofhreuyppp.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5pdWJscGZsaHRvZmhyZXV5cHBwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4ODUzMjIsImV4cCI6MjA4MDQ2MTMyMn0.N19VOQgCoKoRbDbeRz7cDBwftwvHv6OE-U5m-__2LwI';

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async () => {
            await loadPizzaData();
            document.getElementById('loading').style.display = 'none';
        });

        async function loadPizzaData() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Supabase
                const response = await fetch(`${SUPABASE_URL}/rest/v1/pizza_places?select=*&order=price.asc`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                const pizzaData = await response.json();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('totalPlaces').textContent = pizzaData.length;
                
                // –°—á–∏—Ç–∞–µ–º —Å—Ä–µ–¥–Ω—é—é —Ü–µ–Ω—É
                if (pizzaData.length > 0) {
                    const avgPrice = Math.round(
                        pizzaData.reduce((sum, item) => sum + (item.price || 0), 0) / pizzaData.length
                    );
                    document.getElementById('avgPrice').textContent = avgPrice + '‚ÇΩ';
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫
                renderPizzaList(pizzaData);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                document.getElementById('pizzaList').innerHTML = 
                    '<p style="text-align:center;color:red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>';
            }
        }

        function renderPizzaList(places) {
            const container = document.getElementById('pizzaList');
            
            if (places.length === 0) {
                container.innerHTML = '<p style="text-align:center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –ü–µ—Ä–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞.</p>';
                return;
            }
            
            container.innerHTML = places.map(place => `
                <div class="pizza-card">
                    <div class="pizza-name">${place.name}</div>
                    <div class="pizza-price">${place.price ? place.price + '‚ÇΩ' : '–¶–µ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞'}</div>
                    
                    ${place.rating ? `
                        <div class="pizza-rating">
                            <i class="fas fa-star"></i> ${place.rating} 
                            ${place.reviews ? `(${place.reviews} –æ—Ç–∑—ã–≤–æ–≤)` : ''}
                        </div>
                    ` : ''}
                    
                    ${place.address ? `
                        <div class="pizza-address">
                            <i class="fas fa-map-marker-alt"></i> ${place.address}
                        </div>
                    ` : ''}
                    
                    ${place.delivery_time ? `
                        <div class="pizza-address">
                            <i class="fas fa-clock"></i> –î–æ—Å—Ç–∞–≤–∫–∞: ${place.delivery_time}
                        </div>
                    ` : ''}
                    
                    ${place.promocode ? `
                        <div class="promo-badge">
                            <i class="fas fa-gift"></i> –ü—Ä–æ–º–æ–∫–æ–¥: ${place.promocode}
                        </div>
                    ` : ''}
                    
                    <div class="buttons">
                        ${place.yandex_link ? `
                            <a href="${place.yandex_link}" target="_blank" class="btn btn-yandex">
                                <i class="fas fa-map"></i> –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã
                            </a>
                        ` : ''}
                        
                        ${place.website_link ? `
                            <a href="${place.website_link}" target="_blank" class="btn btn-order">
                                <i class="fas fa-shopping-cart"></i> –ó–∞–∫–∞–∑–∞—Ç—å
                            </a>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>